# 営業日報システム 要件定義書

## 1. システム概要

営業担当者が日々の顧客訪問活動を記録し、上長がそれに対してフィードバックを行うためのシステムです。
営業活動の可視化と、上長とのコミュニケーションを円滑にすることを目的としています。

## 2. 機能要件

### 2.1 営業向け機能

#### 2.1.1 日報作成・編集

- 日付ごとに日報を作成できる
- 1つの日報には以下の情報を登録できる
  - 訪問記録（複数件）：顧客選択、訪問内容
  - Problem（課題・相談）：今日の課題や相談事項
  - Plan（明日やること）：翌日の予定やアクションプラン
- 日報の編集は当日のみ可能
- 訪問記録は何件でも追加・削除できる

#### 2.1.2 日報閲覧

- 自分が作成した過去の日報を閲覧できる
- 上長からのコメントを確認できる

#### 2.1.3 顧客マスタ管理

- 訪問記録登録時に顧客マスタから顧客を選択できる
- 顧客マスタの閲覧

### 2.2 上長向け機能

#### 2.2.1 日報閲覧

- 配下の営業担当者の日報を閲覧できる
- 日付、担当者で絞り込み検索ができる

#### 2.2.2 コメント機能

- 配下の営業担当者の日報に対してコメントを投稿できる
- 1つの日報に対して複数のコメントを時系列で投稿可能
- コメントの編集・削除が可能

### 2.3 共通機能

#### 2.3.1 認証・認可

- ログイン/ログアウト機能
- 営業と上長で権限を分離
  - 営業：自分の日報のみ作成・編集可能
  - 上長：配下の営業の日報を閲覧・コメント可能

#### 2.3.2 マスタ管理

- 営業マスタ（ユーザー管理）
- 顧客マスタ

## 3. 非機能要件

### 3.1 セキュリティ

- パスワードはハッシュ化して保存
- セッション管理による認証
- 権限に基づくアクセス制御

### 3.2 ユーザビリティ

- レスポンシブデザイン（PC、タブレット対応）
- 直感的なUI/UX

### 3.3 パフォーマンス

- 日報一覧の表示は3秒以内

### 3.4 データ保持

- 日報データは無期限保存
- 論理削除を採用（物理削除は行わない）

## 4. 主要なビジネスルール

1. **日報の一意性**: 1人の営業担当者が同じ日付に複数の日報を作成できない（user_id と report_date の組み合わせがユニーク）

2. **編集制限**: 日報は当日のみ編集可能（report_date が今日の日付と一致する場合のみ）

3. **権限制御**:
   - 営業（role='sales'）は自分の日報のみ作成・編集可能
   - 上長（role='manager'）は配下の営業（manager_id が自分の id と一致するユーザー）の日報のみ閲覧・コメント可能
   - 上長は自分自身の日報も作成可能（上長も営業活動を行う場合）

4. **訪問順序**: 訪問記録は visit_order で管理され、1つの日報内で1から始まる連番とする

5. **論理削除**: ユーザー、顧客、日報、コメントは物理削除せず、is_deleted フラグで論理削除する
   - 削除されたレコードは通常の検索結果に含めない
   - 管理者機能で削除されたレコードの復元が可能

6. **カスケード削除**: 日報が削除された場合、関連する訪問記録も自動的に削除される

## 5. ユースケース

### 5.1 営業担当者の日報作成フロー

1. ログイン
2. ダッシュボードから「日報作成」を選択
3. 日付を選択（デフォルトは今日）
4. 訪問記録を追加
   - 顧客を選択（顧客マスタから）
   - 訪問内容を入力
   - 必要に応じて複数の訪問記録を追加
5. Problem（課題・相談）を入力
6. Plan（明日やること）を入力
7. 「保存」ボタンをクリック
8. 日報が保存され、ダッシュボードに戻る

### 5.2 上長のコメント投稿フロー

1. ログイン
2. ダッシュボードで配下の営業の日報一覧を表示
3. 日報を選択して詳細画面を表示
4. 訪問記録、Problem、Planを確認
5. コメント入力欄にフィードバックを入力
6. 「コメント投稿」ボタンをクリック
7. コメントが投稿され、営業担当者が確認できるようになる

## 6. 今後の拡張案

- 月次・週次レポート機能
- 訪問予定の登録機能
- グラフやチャートによる分析機能（訪問件数、成約率など）
- 通知機能（上長からコメントがあった場合など）
- ファイル添付機能（写真、資料など）
- モバイルアプリ対応
- 顧客情報の詳細管理（商談履歴、受注情報など）
- 目標設定と進捗管理機能

## 7. 用語集

| 用語     | 説明                                                                         |
| -------- | ---------------------------------------------------------------------------- |
| 営業     | 営業活動を行う担当者。日報を作成する権限を持つ                               |
| 上長     | 営業担当者を管理する管理職。配下の営業の日報を閲覧・コメントする権限を持つ   |
| 日報     | 営業担当者が1日の活動をまとめた報告書                                        |
| 訪問記録 | 1件の顧客訪問に関する記録                                                    |
| Problem  | 今日の課題や相談事項                                                         |
| Plan     | 明日やることや今後のアクションプラン                                         |
| 論理削除 | データベースから物理的に削除せず、削除フラグを立てることで削除扱いとする方式 |

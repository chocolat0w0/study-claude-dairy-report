# 営業日報システム - プロジェクトドキュメント

## プロジェクト概要

営業担当者が日々の顧客訪問活動を記録し、上長がそれに対してフィードバックを行うための業務システムです。
営業活動の可視化と、上長とのコミュニケーションを円滑にすることを目的としています。

## ドキュメント一覧

### 設計ドキュメント

1. 要件定義
   @docs/要件定義.md
   - システム概要
   - 機能要件（営業向け/上長向け/共通機能）
   - 非機能要件
   - データモデル（ER図）
   - テーブル定義詳細（全5テーブル）
   - 主要なビジネスルール
   - ユースケース

2. 画面定義書
   @docs/画面定義書.md
   - 画面一覧（全8画面）
   - 画面遷移図
   - 各画面の詳細仕様
     - ログイン画面
     - ダッシュボード
     - 日報作成/編集/詳細画面
     - 顧客マスタ画面
     - ユーザーマスタ画面
   - ワイヤーフレーム
   - 共通仕様（ヘッダー、ナビゲーション、レスポンシブ対応）

3. テスト仕様書
   @docs/テスト仕様書.md
   - テスト方針
   - テスト環境
   - 詳細なテストケース（全117ケース）
     - 機能テスト
     - 権限制御テスト
     - 非機能テスト（パフォーマンス、セキュリティ、ユーザビリティ）
   - 不具合管理
   - テスト完了基準

4. API定義書
   @docs/API定義書.md
   - API概要（ベースURL、認証方式、データ形式）
   - エンドポイント一覧（全30エンドポイント）
     - 認証API（ログイン、ログアウト、ユーザー情報取得）
     - 日報API（CRUD操作）
     - 訪問記録API（ネストされたリソース）
     - コメントAPI（ネストされたリソース）
     - 顧客マスタAPI（CRUD操作）
     - ユーザーマスタAPI（CRUD操作、管理者のみ）
   - リクエスト/レスポンス仕様
   - バリデーションルール
   - エラーコード定義
   - セキュリティ仕様
   - レート制限

## システムアーキテクチャ

### データベーステーブル

- **users** - 営業マスタ（営業担当者と上長）
- **customers** - 顧客マスタ
- **daily_reports** - 日報
- **visit_records** - 訪問記録
- **comments** - コメント

詳細は[要件定義.md](docs/要件定義.md)のER図とテーブル定義を参照。

### 主要機能

#### 営業向け機能

- 日報作成・編集（当日のみ編集可能）
- 訪問記録の複数登録
- Problem（課題・相談）、Plan（明日やること）の記録
- 過去の日報閲覧
- 上長コメントの確認

#### 上長向け機能

- 配下の営業の日報閲覧
- 日報への複数コメント投稿
- 日付・担当者での絞り込み検索

#### 共通機能

- ログイン/ログアウト
- 権限に基づくアクセス制御
- 顧客マスタ閲覧
- ユーザーマスタ管理（管理者のみ）

## 開発ガイドライン

### テストコード作成時の厳守事項

以下のルールは必ず守ってください：

#### テストコードの品質

- テストは必ず実際の機能を検証すること
- `expect(true).toBe(true)` のような意味のないアサーションは絶対に書かない
- 各テストケースは具体的な入力と期待される出力を検証すること
- モックは必要最小限に留め、実際の動作に近い形でテストすること

#### ハードコーディングの禁止

- テストを通すためだけのハードコードは絶対に禁止
- 本番コードに `if (testMode)` のような条件分岐を入れない
- テスト用の特別な値（マジックナンバー）を本番コードに埋め込まない
- 環境変数や設定ファイルを使用して、テスト環境と本番環境を適切に分離すること

#### テスト実装の原則

- テストが失敗する状態から始めること（Red-Green-Refactor）
- 境界値、異常系、エラーケースも必ずテストすること
- カバレッジだけでなく、実際の品質を重視すること
- テストケース名は何をテストしているか明確に記述すること

#### 実装前の確認

- 機能の仕様を正しく理解してからテストを書くこと
- 不明な点があれば、仮の実装ではなく、ユーザーに確認すること

## 主要なビジネスルール

1. **日報の一意性**: 1人の営業担当者が同じ日付に複数の日報を作成できない
2. **編集制限**: 日報は当日のみ編集可能
3. **権限制御**: 営業は自分の日報のみ、上長は配下の営業の日報のみ操作可能
4. **論理削除**: ユーザー、顧客、日報、コメントは物理削除せず is_deleted フラグで管理
5. **カスケード削除**: 日報が削除された場合、関連する訪問記録も自動的に削除

## 技術スタック（案）

### フロントエンド

- フレームワーク: React / Next.js
- 言語: TypeScript
- UI コンポーネント: shadcn/ui + TailwindCSS
- テスト: Vitest

### バックエンド

- フレームワーク: Next.js API Routes
- 言語: TypeScript
- DB スキーマ定義: Prisma ORM
- API スキーマ定義: OpenAPI (Zodによる検証)

### データベース

- PostgreSQL または MySQL

### 認証

- NextAuth.js またはセッション管理

### テスト

- Jest
- React Testing Library
- Cypress（E2Eテスト）

## 今後の拡張案

- 月次・週次レポート機能
- 訪問予定の登録機能
- グラフやチャートによる分析機能（訪問件数、成約率など）
- 通知機能（上長からコメントがあった場合など）
- ファイル添付機能（写真、資料など）
- モバイルアプリ対応
- 顧客情報の詳細管理（商談履歴、受注情報など）
- 目標設定と進捗管理機能

## 開発の進め方

1. **要件確認**: [要件定義.md](要件定義.md)でシステム要件を確認
2. **画面設計確認**: [画面定義書.md](画面定義書.md)で画面仕様とワイヤーフレームを確認
3. **データベース設計**: 要件定義書のER図とテーブル定義を基にデータベースを構築
4. **機能実装**: 画面定義書に従って各機能を実装
5. **テスト実施**: [テスト仕様書.md](テスト仕様書.md)に従ってテストを実施
6. **不具合修正**: テストで発見された不具合を修正
7. **受け入れテスト**: ユーザーによる受け入れテスト
8. **リリース**: 本番環境へのデプロイ

## プロジェクト構成（例）

```
study-claude-dairy-report/
├── CLAUDE.md               # このファイル
├── README.md               # プロジェクト概要
├── 要件定義.md             # 要件定義書
├── 画面定義書.md           # 画面定義書
├── テスト仕様書.md         # テスト仕様書
├── src/
│   ├── components/         # Reactコンポーネント
│   ├── pages/              # ページコンポーネント
│   ├── api/                # APIエンドポイント
│   ├── lib/                # ユーティリティ
│   ├── types/              # TypeScript型定義
│   └── tests/              # テストコード
├── prisma/
│   ├── schema.prisma       # Prismaスキーマ
│   └── migrations/         # マイグレーションファイル
├── public/                 # 静的ファイル
└── docs/                   # その他ドキュメント
```

## 参考情報

### 関連リンク

- [Next.js Documentation](https://nextjs.org/docs)
- [Prisma Documentation](https://www.prisma.io/docs)
- [React Documentation](https://react.dev)

### 連絡先

- プロジェクトオーナー: TBD
- 開発リーダー: TBD
- QAリーダー: TBD
